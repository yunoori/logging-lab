# Логгирование и управление логами

Логгирование и управление логами с использованием Python и библиотеки `logging`


## ▎1. Простое задание (объяснение по шагам для освоения основ)

Цель: Изучить базовые понятия модуля logging в Python: уровни логгирования, создание лог-файлов и форматирование сообщений.

### Шаги:

## Шаг 1. Импорт модуля logging

Что делать:  
- Откройте вашу среду разработки (IDE), например, PyCharm, VS Code или стандартный редактор Python (IDLE).  
- Создайте новый Python-файл (например, назовите его logging_basics.py).  
- В первой строке вашего файла добавьте импорт модуля logging:

```
import logging
```

Зачем это нужно:  
Этот модуль является встроенным в Python, и вы используете его для работы с логами.


## Шаг 2. Настройка логгера

Что делать:  
- Теперь в вашем файле добавьте следующую настройку для логгирования, воспользовавшись функцией logging.basicConfig().

```
logging.basicConfig(
    level=logging.DEBUG,  # Уровень логгирования
    format='%(asctime)s - %(levelname)s - %(message)s',  # Формат сообщения
    filename='app.log',  # Имя файла, куда будут сохраняться логи
    filemode='w'  # Открытие файла для записи (удаляет старые логи)
)
```

Описание параметров:
- level=logging.DEBUG — указывает уровень логов. Уровни:
  - DEBUG: подробная информация для отладки.
  - INFO: общая информация.
  - WARNING: важные предупреждения (но не ошибки).
  - ERROR: ошибки, требующие исправления.
  - CRITICAL: важные критические ошибки.
- format: задает, как будут выглядеть строки логов. В данном случае:
  - %(asctime)s — время записи лога.
  - %(levelname)s — указание уровня (DEBUG, INFO, ERROR и пр.).
  - %(message)s — текст сообщения.
- filename: указывает, где будут записаны логи (в данном случае в файл app.log).
- filemode: w — файл будет перезаписываться при каждом запуске программы; можно поменять на a, чтобы логи добавлялись в существующий файл.

После настройки ваш код будет выглядеть так:
```
import logging

logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(levelname)s - %(message)s',
    filename='app.log',
    filemode='w'
)
```


## Шаг 3. Логирование сообщений разного уровня

Что делать:  
- После настройки логгера напишите команды для логгирования, чтобы протестировать их работу.
- Используйте следующие примеры:

```
logging.debug("Сообщение уровня DEBUG: Это вспомогательная информация для отладки.")
logging.info("Сообщение уровня INFO: Программа работает корректно.")
logging.warning("Сообщение уровня WARNING: Что-то может пойти не так.")
logging.error("Сообщение уровня ERROR: Произошла ошибка, требуется исправление.")
logging.critical("Сообщение уровня CRITICAL: Критическая ошибка, программа может быть завершена.")
```

Объяснение:  
- Каждое из этих сообщений будет добавлено в файл app.log с соответствующим уровнем (DEBUG, INFO, WARNING, ERROR, CRITICAL).
- Вы можете заменить сообщения своим текстом, чтобы отобразить вашу ситуацию.

После добавления эти строки вашего кода выглядят так:

```
import logging

# Настройка
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(levelname)s - %(message)s',
    filename='app.log',
    filemode='w'
)

# Сообщения разных уровней
logging.debug("Сообщение уровня DEBUG: Это вспомогательная информация для отладки.")
logging.info("Сообщение уровня INFO: Программа работает корректно.")
logging.warning("Сообщение уровня WARNING: Что-то может пойти не так.")
logging.error("Сообщение уровня ERROR: Произошла ошибка, требуется исправление.")
logging.critical("Сообщение уровня CRITICAL: Критическая ошибка, программа может быть завершена.")
```


## Шаг 4. Запуск программы и проверка лог-файла

Что делать:  
- Сохраните файл logging_basics.py.
- Запустите вашу программу (например, с помощью кнопки "Run" в вашей IDE или командой в терминале python logging_basics.py).
- Убедитесь, что в текущей папке появился файл app.log.


## Шаг 5. Проверка содержимого файла app.log

Что делать:  
- Откройте файл app.log в текстовом редакторе (например, через Notepad или прямо в IDE).
- - Убедитесь, что в нем записаны сообщения, которые вы логгировали. Пример содержимого файла может быть следующим:

```
2023-10-30 10:00:00,000 - DEBUG - Сообщение уровня DEBUG: Это вспомогательная информация для отладки.
2023-10-30 10:00:00,001 - INFO - Сообщение уровня INFO: Программа работает корректно.
2023-10-30 10:00:00,002 - WARNING - Сообщение уровня WARNING: Что-то может пойти не так.
2023-10-30 10:00:00,003 - ERROR - Сообщение уровня ERROR: Произошла ошибка, требуется исправление.
2023-10-30 10:00:00,004 - CRITICAL - Сообщение уровня CRITICAL: Критическая ошибка, программа может быть завершена.
```

Проверка:  
Сообщения записаны? Значит, ваша программа работает правильно!


## Что попробовать еще?

1. Изменить параметр level:   
Попробуйте изменить параметр level на logging.WARNING. Теперь логи уровней DEBUG и INFO не будут записаны в файл, так как они ниже установленного уровня. Запустите программу и проверьте.
   
2. Добавить логирование в консоль:  
Чтобы логи отображались не только в файле, но и в консоли, вы можете заменить настройку logging.basicConfig так:

```
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(levelname)s - %(message)s'
)
```

(В данном случае filename не указывается, и логи идут только в консоль.)


Таким образом, вы настроили базовую систему логгирования и протестировали работу с разными уровнями. На следующих этапах вы добавите ротацию логов и более сложные функции логгирования.

## ▎2. Задача на выполнение

### Задание:
Создайте программу на Python, которая будет обрабатывать список URL-адресов (например, имитация API-запросов). Реализуйте:
- Уровень DEBUG для отображения всей информации о работе программы;
- Уровень WARNING для логирования пропущенных или некорректных ссылок;
- Ошибки (ERROR) в случае невозможности соединения с сервером;
- Советы (INFO) о прогрессе обработки.

### Условия:
- Добавьте ротацию логов с ограничением на 1 МБ объема и 5 резервными копиями.
- Логи должны сохраняться в logs/app.log.
- Реализуйте задержку между запросами для имитации работы (например, через time.sleep()).

#### 1. Настройка логгера

Логгер — это инструмент, который записывает информацию о работе программы в файл или консоль. Здесь:
- Используется модуль logging и RotatingFileHandler.
- Логи будут сохраняться в файл logs/app.log.
- Ограничение лог-файла: 1 МБ, с 5 резервными копиями.
- Формат лога: дата-время, уровень сообщения (DEBUG, INFO, WARNING, ERROR), текст сообщения.

Код настройки:
```
handler = RotatingFileHandler('logs/app.log', maxBytes=1024*1024, backupCount=5)
logging.basicConfig(
    level=logging.DEBUG,  # Отображаются все виды логов
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[handler]
)
```


#### 2. Подготовка списка URL-адресов

Создаем список для имитации входных данных. Например:
```
urls = ["https://example.com", "https://invalid-url", "https://example.net"]
```

- Здесь часть ссылок корректные, а часть нет (например, invalid-url является неверной).


#### 3. Обработка URL-адресов

Циклически проходим по списку urls с помощью for url in urls:. 
Для каждого URL:
- Логируем начало обработки (logging.info).
- Проверяем на некорректность ("invalid" в URL вызывает ошибку).
- Реализуем задержку для имитации работы (time.sleep(1)).
- Логируем успешную обработку URL или ошибку.

Пример кода:
```
for url in urls:
    logging.info(f"Начало обработки: {url}")
    try:
        if "invalid" in url:  # Искусственная проверка на некорректный URL
            raise ValueError("Некорректный URL")
        time.sleep(1)  # Имитация задержки
        logging.debug(f"Обработка успешна: {url}")
    except Exception as e:
        logging.error(f"Ошибка при обработке {url} - {e}")
    finally:
        logging.info(f"Завершение обработки: {url}")
```


#### 4. Уровни логирования

Различные уровни логов используются для разного типа сообщений:
- DEBUG: Подробная информация — успешная обработка.
- INFO: События высокого уровня — начало и завершение обработки ссылки.
- WARNING: Предупреждения о некорректных ссылках.
- ERROR: Ошибки при обработке — например, невозможность подключения или некорректный формат данных.

Пример использования в коде:
```
logging.debug("Сообщение для отладки программы")
logging.info("Начало обработки задачи")
logging.warning("Некорректный или пропущенный URL")
logging.error("Ошибка при обработке")
```

#### 5. Итоговые логи

После выполнения программы файл logs/app.log будет содержать что-то вроде:
```
2023-10-17 10:00:00 - INFO - Начало обработки: https://example.com
2023-10-17 10:00:01 - DEBUG - Обработка успешна: https://example.com
2023-10-17 10:00:02 - INFO - Завершение обработки: https://example.com
2023-10-17 10:00:03 - INFO - Начало обработки: https://invalid-url
2023-10-17 10:00:03 - ERROR - Ошибка при обработке https://invalid-url - Некорректный URL
2023-10-17 10:00:04 - INFO - Завершение обработки: https://invalid-url
```


## ▎3. Материалы для самостоятельного изучения:

- Официальная документация Python по модулю logging:  
  https://docs.python.org/3/library/logging.html

- Введение в ротацию логов (RotatingFileHandler):
  https://realpython.com/python-logging/#rotating-log-files

- Применение формата для логов:  
  https://docs.python.org/3/howto/logging.html#logging-from-multiple-threads
